{% extends "admin/base.html" %}

{% block title %}Backup & Restore{% endblock %}
{% block breadcrumb %}Backup{% endblock %}

{% block content %}
<div class="page-header">
    <div class="page-header-top">
        <div>
            <h1 class="page-title">Backup & Restore</h1>
            <p class="page-subtitle">Manage database backups and recovery</p>
        </div>
        <form action="{{ url_for('admin.create_backup') }}" method="POST" style="display: inline;">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <button type="submit" class="btn btn-primary">
                <i data-lucide="download" style="width: 16px; height: 16px;"></i>
                Create Backup
            </button>
        </form>
    </div>
</div>

<div class="admin-grid grid-2">
    <!-- Create New Backup -->
    <div class="admin-card">
        <div class="admin-card-header">
            <h2 class="admin-card-title">Create New Backup</h2>
        </div>
        <div class="admin-card-body">
            <div style="text-align: center; padding: 30px 0;">
                <div style="width: 64px; height: 64px; background: rgba(88, 166, 255, 0.15); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 16px;">
                    <i data-lucide="database" style="width: 28px; height: 28px; color: var(--admin-accent);"></i>
                </div>
                <h3 style="margin: 0 0 8px; font-size: 16px; font-weight: 600;">Database Backup</h3>
                <p class="text-secondary" style="margin: 0 0 20px; font-size: 14px;">Create a complete backup of your database</p>
                <form action="{{ url_for('admin.create_backup') }}" method="POST">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <button type="submit" class="btn btn-primary" style="width: 100%; justify-content: center;">
                        <i data-lucide="hard-drive-download" style="width: 16px; height: 16px;"></i>
                        Create Backup Now
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Backup Status -->
    <div class="admin-card">
        <div class="admin-card-header">
            <h2 class="admin-card-title">Backup Status</h2>
        </div>
        <div class="admin-card-body">
            <div style="display: flex; flex-direction: column; gap: 16px;">
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 16px; background: var(--admin-bg-tertiary); border-radius: 8px;">
                    <span>Backup Directory</span>
                    <span class="text-secondary">backups/</span>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 16px; background: var(--admin-bg-tertiary); border-radius: 8px;">
                    <span>Total Backups</span>
                    <span style="background: rgba(88, 166, 255, 0.15); color: var(--admin-accent); padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 500;">
                        {{ backups|length }} files
                    </span>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 16px; background: var(--admin-bg-tertiary); border-radius: 8px;">
                    <span>Last Backup</span>
                    <span class="text-secondary">
                        {% if backups %}
                            {{ backups[0].date.strftime('%Y-%m-%d %H:%M') }}
                        {% else %}
                            Never
                        {% endif %}
                    </span>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Existing Backups -->
<div class="admin-card" style="margin-top: 24px;">
    <div class="admin-card-header">
        <h2 class="admin-card-title">Existing Backups</h2>
    </div>
    <div class="admin-card-body" style="padding: 0;">
        {% if backups %}
        <div style="overflow-x: auto;">
            <table class="admin-table" style="width: 100%;">
                <thead>
                    <tr>
                        <th style="padding: 14px 20px; text-align: left; font-weight: 600; font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px; color: var(--admin-text-secondary); border-bottom: 1px solid var(--admin-border);">Filename</th>
                        <th style="padding: 14px 20px; text-align: left; font-weight: 600; font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px; color: var(--admin-text-secondary); border-bottom: 1px solid var(--admin-border);">Size</th>
                        <th style="padding: 14px 20px; text-align: left; font-weight: 600; font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px; color: var(--admin-text-secondary); border-bottom: 1px solid var(--admin-border);">Created</th>
                        <th style="padding: 14px 20px; text-align: right; font-weight: 600; font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px; color: var(--admin-text-secondary); border-bottom: 1px solid var(--admin-border);">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for backup in backups %}
                    <tr>
                        <td style="padding: 14px 20px; border-bottom: 1px solid var(--admin-border);">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <i data-lucide="file-archive" style="width: 18px; height: 18px; color: var(--admin-text-secondary);"></i>
                                <span style="font-weight: 500;">{{ backup.name }}</span>
                            </div>
                        </td>
                        <td style="padding: 14px 20px; border-bottom: 1px solid var(--admin-border); color: var(--admin-text-secondary);">{{ backup.size }} MB</td>
                        <td style="padding: 14px 20px; border-bottom: 1px solid var(--admin-border); color: var(--admin-text-secondary);">{{ backup.date.strftime('%Y-%m-%d %H:%M') }}</td>
                        <td style="padding: 14px 20px; border-bottom: 1px solid var(--admin-border); text-align: right;">
                            <a href="#" class="btn btn-secondary" style="font-size: 12px; padding: 6px 12px;">
                                <i data-lucide="download" style="width: 14px; height: 14px;"></i>
                                Download
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div style="text-align: center; padding: 60px 20px;">
            <div style="width: 64px; height: 64px; background: var(--admin-bg-tertiary); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 16px;">
                <i data-lucide="archive" style="width: 28px; height: 28px; color: var(--admin-text-secondary);"></i>
            </div>
            <h3 style="margin: 0 0 8px; font-size: 16px; font-weight: 600;">No backups yet</h3>
            <p class="text-secondary" style="margin: 0; font-size: 14px;">Create your first backup to secure your data</p>
        </div>
        {% endif %}
    </div>
</div>

<!-- Warning Card -->
<div class="admin-card" style="margin-top: 24px; border-left: 4px solid #D29922;">
    <div class="admin-card-body">
        <div style="display: flex; gap: 16px; align-items: flex-start;">
            <div style="width: 40px; height: 40px; background: rgba(210, 153, 34, 0.15); border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                <i data-lucide="alert-triangle" style="width: 20px; height: 20px; color: #D29922;"></i>
            </div>
            <div>
                <h3 style="margin: 0 0 8px; font-size: 16px; font-weight: 600; color: #D29922;">Important Notice</h3>
                <p class="text-secondary" style="margin: 0; font-size: 14px; line-height: 1.6;">
                    Backups should be stored securely and tested regularly. For production environments, consider implementing automated backup solutions with off-site storage.
                </p>
            </div>
        </div>
    </div>
</div>
{% endblock %}
