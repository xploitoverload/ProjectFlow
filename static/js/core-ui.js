/**\n * Core UI Interactions - Essential JavaScript for dropdown, modal, and form functionality\n * This file provides the basic interactivity that makes the UI functional.\n */\n\n// Global UI Controller\nclass UIController {\n    constructor() {\n        this.init();\n    }\n    \n    init() {\n        this.setupDropdowns();\n        this.setupModals();\n        this.setupFormValidation();\n        this.setupKeyboardShortcuts();\n        this.setupLoadingStates();\n        \n        console.log('✅ UI Controller initialized');\n    }\n    \n    // ========== DROPDOWN FUNCTIONALITY ==========\n    setupDropdowns() {\n        // Handle all select elements\n        document.querySelectorAll('select').forEach(select => {\n            // Ensure change events work\n            select.addEventListener('change', (e) => {\n                // Trigger any onchange attributes\n                if (e.target.onchange) {\n                    e.target.onchange();\n                }\n            });\n        });\n        \n        // Custom dropdown handling\n        document.addEventListener('click', (e) => {\n            // Close all dropdowns when clicking outside\n            if (!e.target.closest('.dropdown')) {\n                this.closeAllDropdowns();\n            }\n        });\n    }\n    \n    closeAllDropdowns() {\n        document.querySelectorAll('.dropdown.open').forEach(dropdown => {\n            dropdown.classList.remove('open');\n        });\n    }\n    \n    // ========== MODAL FUNCTIONALITY ==========\n    setupModals() {\n        // Auto-setup modal close buttons\n        document.querySelectorAll('.modal .btn-icon, .modal .modal-backdrop').forEach(btn => {\n            btn.addEventListener('click', (e) => {\n                if (e.target.classList.contains('modal-backdrop') || e.target.closest('.btn-icon')) {\n                    this.closeModal(e.target.closest('.modal'));\n                }\n            });\n        });\n        \n        // ESC key closes modals\n        document.addEventListener('keydown', (e) => {\n            if (e.key === 'Escape') {\n                this.closeAllModals();\n            }\n        });\n    }\n    \n    openModal(modalId) {\n        const modal = document.getElementById(modalId);\n        if (modal) {\n            modal.style.display = 'flex';\n            modal.classList.add('show');\n            \n            // Focus first input\n            const firstInput = modal.querySelector('input, select, textarea');\n            if (firstInput) {\n                setTimeout(() => firstInput.focus(), 100);\n            }\n            \n            console.log(`Opened modal: ${modalId}`);\n        }\n    }\n    \n    closeModal(modal) {\n        if (typeof modal === 'string') {\n            modal = document.getElementById(modal);\n        }\n        \n        if (modal) {\n            modal.style.display = 'none';\n            modal.classList.remove('show');\n            \n            // Reset form if present\n            const form = modal.querySelector('form');\n            if (form) {\n                form.reset();\n                this.clearFormErrors(form);\n            }\n        }\n    }\n    \n    closeAllModals() {\n        document.querySelectorAll('.modal').forEach(modal => {\n            this.closeModal(modal);\n        });\n    }\n    \n    // ========== FORM VALIDATION ==========\n    setupFormValidation() {\n        document.querySelectorAll('form').forEach(form => {\n            form.addEventListener('submit', (e) => {\n                if (!this.validateForm(form)) {\n                    e.preventDefault();\n                    return false;\n                }\n                \n                // Show loading state for submit buttons\n                const submitBtn = form.querySelector('button[type=\"submit\"]');\n                if (submitBtn) {\n                    this.showLoadingState(submitBtn);\n                }\n            });\n        });\n    }\n    \n    validateForm(form) {\n        let isValid = true;\n        this.clearFormErrors(form);\n        \n        // Check required fields\n        form.querySelectorAll('[required]').forEach(field => {\n            if (!field.value.trim()) {\n                this.showFieldError(field, 'This field is required');\n                isValid = false;\n            }\n        });\n        \n        // Custom validations\n        const customValidations = {\n            email: /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/,\n            url: /^https?:\\/\\/.+/,\n            number: /^\\d+$/\n        };\n        \n        form.querySelectorAll('[data-validate]').forEach(field => {\n            const validateType = field.dataset.validate;\n            if (customValidations[validateType] && field.value) {\n                if (!customValidations[validateType].test(field.value)) {\n                    this.showFieldError(field, `Please enter a valid ${validateType}`);\n                    isValid = false;\n                }\n            }\n        });\n        \n        return isValid;\n    }\n    \n    showFieldError(field, message) {\n        field.classList.add('error');\n        \n        // Remove existing error message\n        const existingError = field.parentNode.querySelector('.field-error');\n        if (existingError) {\n            existingError.remove();\n        }\n        \n        // Add new error message\n        const errorDiv = document.createElement('div');\n        errorDiv.className = 'field-error';\n        errorDiv.textContent = message;\n        errorDiv.style.cssText = 'color: #dc3545; font-size: 12px; margin-top: 4px;';\n        field.parentNode.appendChild(errorDiv);\n        \n        // Focus first error field\n        if (!field.parentNode.querySelector('.error')) {\n            field.focus();\n        }\n    }\n    \n    clearFormErrors(form) {\n        form.querySelectorAll('.error').forEach(field => {\n            field.classList.remove('error');\n        });\n        form.querySelectorAll('.field-error').forEach(error => {\n            error.remove();\n        });\n    }\n    \n    // ========== LOADING STATES ==========\n    setupLoadingStates() {\n        // Auto-handle loading states for buttons with data-loading-text\n        document.querySelectorAll('[data-loading-text]').forEach(btn => {\n            btn.addEventListener('click', () => {\n                this.showLoadingState(btn);\n            });\n        });\n    }\n    \n    showLoadingState(button) {\n        if (button.dataset.originalText) return; // Already loading\n        \n        button.dataset.originalText = button.textContent;\n        button.textContent = button.dataset.loadingText || 'Loading...';\n        button.disabled = true;\n        \n        // Auto-reset after 10 seconds (failsafe)\n        setTimeout(() => {\n            this.hideLoadingState(button);\n        }, 10000);\n    }\n    \n    hideLoadingState(button) {\n        if (button.dataset.originalText) {\n            button.textContent = button.dataset.originalText;\n            delete button.dataset.originalText;\n            button.disabled = false;\n        }\n    }\n    \n    // ========== KEYBOARD SHORTCUTS ==========\n    setupKeyboardShortcuts() {\n        document.addEventListener('keydown', (e) => {\n            // Ctrl+Enter to submit forms\n            if (e.ctrlKey && e.key === 'Enter') {\n                const activeForm = document.activeElement.closest('form');\n                if (activeForm) {\n                    e.preventDefault();\n                    const submitBtn = activeForm.querySelector('button[type=\"submit\"]');\n                    if (submitBtn) submitBtn.click();\n                }\n            }\n        });\n    }\n    \n    // ========== UTILITY METHODS ==========\n    showNotification(message, type = 'info', duration = 3000) {\n        const notification = document.createElement('div');\n        notification.className = `notification notification-${type}`;\n        notification.textContent = message;\n        notification.style.cssText = `\n            position: fixed;\n            top: 20px;\n            right: 20px;\n            padding: 12px 20px;\n            border-radius: 6px;\n            color: white;\n            font-weight: 500;\n            z-index: 10000;\n            opacity: 0;\n            transform: translateX(100%);\n            transition: all 0.3s ease;\n            max-width: 400px;\n        `;\n        \n        // Set colors based on type\n        const colors = {\n            success: '#10b981',\n            error: '#ef4444',\n            warning: '#f59e0b',\n            info: '#3b82f6'\n        };\n        notification.style.backgroundColor = colors[type] || colors.info;\n        \n        document.body.appendChild(notification);\n        \n        // Animate in\n        setTimeout(() => {\n            notification.style.opacity = '1';\n            notification.style.transform = 'translateX(0)';\n        }, 100);\n        \n        // Auto-remove\n        setTimeout(() => {\n            notification.style.opacity = '0';\n            notification.style.transform = 'translateX(100%)';\n            setTimeout(() => notification.remove(), 300);\n        }, duration);\n    }\n}\n\n// Global functions for template compatibility\nfunction openCreateIssueModal() {\n    window.uiController.openModal('createIssueModal');\n}\n\nfunction closeCreateIssueModal() {\n    window.uiController.closeModal('createIssueModal');\n}\n\nfunction updateFormAction(projectId) {\n    const form = document.getElementById('createIssueForm');\n    if (form && projectId) {\n        form.action = `/project/${projectId}/issue/add`;\n        console.log(`Form action updated to: ${form.action}`);\n    }\n}\n\nfunction showNotification(message, type = 'info') {\n    if (window.uiController) {\n        window.uiController.showNotification(message, type);\n    } else {\n        alert(message); // Fallback\n    }\n}\n\n// Initialize when DOM is ready\ndocument.addEventListener('DOMContentLoaded', function() {\n    window.uiController = new UIController();\n    \n    // Initialize Lucide icons if available\n    if (typeof lucide !== 'undefined') {\n        lucide.createIcons();\n        console.log('✅ Lucide icons initialized');\n    }\n    \n    console.log('✅ Core UI initialized - Forms, modals, dropdowns are now functional');\n});